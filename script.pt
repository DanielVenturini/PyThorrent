#----------decodifica o arquivo--------------------------------------------
from BencodeDecode import (Decode, Bencode)
#dec = Decode('torrentsproibidos/velozes.torrent')
dec = Decode('example.torrent/ubuntu-18.04-desktop-amd64.iso.torrent')
dec.decodeFullFile()

dic = dec.dic
#--------calcula o sha1-----------------------------------------------------
import hashlib
def getSHA1(rawinfo):
        sha = hashlib.sha1()
        sha.update(rawinfo)
        return sha.hexdigest()

#---------recupera as informacoes--------------------------------------------
from THP_PWP import CommonDef
announce = dic['announce']
torrentName = dic['info']['name']
lenTorrent = CommonDef.getFullLefFile(dic)
info_hash = getSHA1(dic['info'])
peer_id = CommonDef.getPeerId()
port = CommonDef.getPort()
uploaded, downloaded, left = CommonDef.getProperties(torrentName, lenTorrent)

#---------cria mensagem------------------------------------------------------
mensagem = 'GET ' + announce +'?' +\
            'info_hash=' + str(info_hash) + '&' +\
            'peer_id=' + peer_id + '&' +\
            'port=' + str(port) + '&' +\
            'uploaded=' + str(uploaded) + '&' +\
            'downloaded=' + str(downloaded) + '&' +\
            'left=' + str(left) + '&' +\
            'event=started' +\
            ' HTTP/1.1\r\n\r\n'
#--------cria socket---------------------------------------------------------
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('torrent.ubuntu.com', 6969))
s.send(mensagem.encode())
s.recv(1024)
s.close()
#-------cria socket udp-----
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
ip, port = s.getsockname()
s.bind((ip, port))
s.sendto(mensagem.encode(), ('87.233.192.220', 6969))
s.recvfrom(1024)
s.close()
------------------------------------------------------------------------------
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#s.bind(('192.168.0.105', 6969))
s.connect(('tracker.documentfoundation.org', 6969))
#s.sendto(mensagem.encode(), ('tracker.leechers-paradise.org', 6969))
#s.recvfrom(100)
s.send(mensagem.encode())
s.recv(100)
s.close()